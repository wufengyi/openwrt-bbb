\hypertarget{group__elfloaderarch}{}\section{Architecture specific functionality for the E\+L\+F loader.}
\label{group__elfloaderarch}\index{Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}}
\subsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \hyperlink{elfloader-arch_8h}{elfloader-\/arch.\+h}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{group__elfloaderarch_ga1583b48c655f508d845d1a22bd54d2a3}{elfloader\+\_\+arch\+\_\+allocate\+\_\+ram} (int size)
\begin{DoxyCompactList}\small\item\em Allocate R\+A\+M for a new module. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{group__elfloaderarch_gabf03ff0788cfecc08e82ec0fc3bff6f7}{elfloader\+\_\+arch\+\_\+allocate\+\_\+rom} (int size)
\begin{DoxyCompactList}\small\item\em Allocate program memory for a new module. \end{DoxyCompactList}\item 
void \hyperlink{group__elfloaderarch_gab20475a2c29caa2906b860368895944b}{elfloader\+\_\+arch\+\_\+relocate} (int fd, unsigned int sectionoffset, char $\ast$sectionaddr, struct \hyperlink{structelf32__rela}{elf32\+\_\+rela} $\ast$rela, char $\ast$addr)
\begin{DoxyCompactList}\small\item\em Perform a relocation. \end{DoxyCompactList}\item 
void \hyperlink{group__elfloaderarch_ga83a40c77924d5791d8ec67f3465a99de}{elfloader\+\_\+arch\+\_\+write\+\_\+rom} (int fd, unsigned short textoff, unsigned int size, char $\ast$mem)
\begin{DoxyCompactList}\small\item\em Write to read-\/only memory (for example the text segment). \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
The architecture specific functionality for the Contiki E\+L\+F loader has to be implemented for each processor type Contiki runs on.

Since the E\+L\+F format is slightly different for different processor types, the Contiki E\+L\+F loader is divided into two parts\+: the generic E\+L\+F loader module (\hyperlink{group__elfloader}{The Contiki E\+L\+F loader}) and the architecture specific part (this module). The architecture specific part deals with memory allocation, code and data relocation, and writing the relocated E\+L\+F code into program memory.

To port the Contiki E\+L\+F loader to a new processor type, this module has to be implemented for the new processor type. 

\subsection{Function Documentation}
\hypertarget{group__elfloaderarch_ga1583b48c655f508d845d1a22bd54d2a3}{}\index{Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}!elfloader\+\_\+arch\+\_\+allocate\+\_\+ram@{elfloader\+\_\+arch\+\_\+allocate\+\_\+ram}}
\index{elfloader\+\_\+arch\+\_\+allocate\+\_\+ram@{elfloader\+\_\+arch\+\_\+allocate\+\_\+ram}!Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}}
\subsubsection[{elfloader\+\_\+arch\+\_\+allocate\+\_\+ram}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ elfloader\+\_\+arch\+\_\+allocate\+\_\+ram (
\begin{DoxyParamCaption}
\item[{int}]{size}
\end{DoxyParamCaption}
)}\label{group__elfloaderarch_ga1583b48c655f508d845d1a22bd54d2a3}


Allocate R\+A\+M for a new module. 


\begin{DoxyParams}{Parameters}
{\em size} & The size of the requested memory. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A pointer to the allocated R\+A\+M \begin{DoxyVerb}        This function is called from the Contiki ELF loader to
        allocate RAM for the module to be loaded into.
\end{DoxyVerb}

\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000001}{Bug}]The Contiki E\+L\+F loader currently does not contain a mechanism for deallocating the memory allocated with this function. \end{DoxyRefDesc}
\hypertarget{group__elfloaderarch_gabf03ff0788cfecc08e82ec0fc3bff6f7}{}\index{Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}!elfloader\+\_\+arch\+\_\+allocate\+\_\+rom@{elfloader\+\_\+arch\+\_\+allocate\+\_\+rom}}
\index{elfloader\+\_\+arch\+\_\+allocate\+\_\+rom@{elfloader\+\_\+arch\+\_\+allocate\+\_\+rom}!Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}}
\subsubsection[{elfloader\+\_\+arch\+\_\+allocate\+\_\+rom}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ elfloader\+\_\+arch\+\_\+allocate\+\_\+rom (
\begin{DoxyParamCaption}
\item[{int}]{size}
\end{DoxyParamCaption}
)}\label{group__elfloaderarch_gabf03ff0788cfecc08e82ec0fc3bff6f7}


Allocate program memory for a new module. 


\begin{DoxyParams}{Parameters}
{\em size} & The size of the requested memory. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A pointer to the allocated program memory \begin{DoxyVerb}        This function is called from the Contiki ELF loader to
        allocate program memory (typically ROM) for the module
        to be loaded into.
\end{DoxyVerb}

\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000002}{Bug}]The Contiki E\+L\+F loader currently does not contain a mechanism for deallocating the memory allocated with this function. \end{DoxyRefDesc}
\hypertarget{group__elfloaderarch_gab20475a2c29caa2906b860368895944b}{}\index{Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}!elfloader\+\_\+arch\+\_\+relocate@{elfloader\+\_\+arch\+\_\+relocate}}
\index{elfloader\+\_\+arch\+\_\+relocate@{elfloader\+\_\+arch\+\_\+relocate}!Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}}
\subsubsection[{elfloader\+\_\+arch\+\_\+relocate}]{\setlength{\rightskip}{0pt plus 5cm}void elfloader\+\_\+arch\+\_\+relocate (
\begin{DoxyParamCaption}
\item[{int}]{fd, }
\item[{unsigned int}]{sectionoffset, }
\item[{char $\ast$}]{sectionaddr, }
\item[{struct {\bf elf32\+\_\+rela} $\ast$}]{rela, }
\item[{char $\ast$}]{addr}
\end{DoxyParamCaption}
)}\label{group__elfloaderarch_gab20475a2c29caa2906b860368895944b}


Perform a relocation. 


\begin{DoxyParams}{Parameters}
{\em fd} & The file descriptor for the E\+L\+F file. \\
\hline
{\em sectionoffset} & The file offset at which the relocation can be found. \\
\hline
{\em sectionaddr} & The section start address (absolute runtime). \\
\hline
{\em rela} & A pointer to an E\+L\+F32 rela structure (struct \hyperlink{structelf32__rela}{elf32\+\_\+rela}). \\
\hline
{\em addr} & The relocated address. \begin{DoxyVerb}        This function is called from the Contiki ELF loader to
        perform a relocation on a piece of code or data. The
        relocated address is calculated by the Contiki ELF
        loader, based on information in the ELF file, and it is
        the responsibility of this function to patch the
        executable code. The Contiki ELF loader passes a
        pointer to an ELF32 rela structure (struct elf32_rela)
        that contains information about how to patch the
        code. This information is different from processor to
        processor.\end{DoxyVerb}
 \\
\hline
\end{DoxyParams}
\hypertarget{group__elfloaderarch_ga83a40c77924d5791d8ec67f3465a99de}{}\index{Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}!elfloader\+\_\+arch\+\_\+write\+\_\+rom@{elfloader\+\_\+arch\+\_\+write\+\_\+rom}}
\index{elfloader\+\_\+arch\+\_\+write\+\_\+rom@{elfloader\+\_\+arch\+\_\+write\+\_\+rom}!Architecture specific functionality for the E\+L\+F loader.@{Architecture specific functionality for the E\+L\+F loader.}}
\subsubsection[{elfloader\+\_\+arch\+\_\+write\+\_\+rom}]{\setlength{\rightskip}{0pt plus 5cm}void elfloader\+\_\+arch\+\_\+write\+\_\+rom (
\begin{DoxyParamCaption}
\item[{int}]{fd, }
\item[{unsigned short}]{textoff, }
\item[{unsigned int}]{size, }
\item[{char $\ast$}]{mem}
\end{DoxyParamCaption}
)}\label{group__elfloaderarch_ga83a40c77924d5791d8ec67f3465a99de}


Write to read-\/only memory (for example the text segment). 


\begin{DoxyParams}{Parameters}
{\em fd} & The file descriptor for the E\+L\+F file. \\
\hline
{\em textoff} & Offset of text segment relative start of file. \\
\hline
{\em size} & The size of the text segment. \\
\hline
{\em mem} & A pointer to the where the text segment should be flashed \begin{DoxyVerb}        This function is called from the Contiki ELF loader to
        write the program code (text segment) of a loaded
        module into memory. The function is called when all
        relocations have been performed.\end{DoxyVerb}
 \\
\hline
\end{DoxyParams}
